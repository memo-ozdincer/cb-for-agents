
 Loaded: 2000

--- Loading Harmful: AgentDojo (all traces in data/agent_dojo) ---
  Loaded: 1363

--- Loading Harmful: AgentHarm ---
  Loaded: 208

  HARMFUL TOTALS: Fujitsu(B4)=13246, Fujitsu(B1)=10943, Fujitsu(B3)=10003, Fujitsu(B2)=2000, AgentDojo=1363, AgentHarm=208

--- Loading Benign: WebArena ---
  Loaded: 812

--- Loading Benign: TAU2 ---
  Loaded: 0

--- Loading Benign: WebLINX ---
  Loaded: 100

--- Loading Benign: AgentDojo (all traces in data/agent_dojo) ---
  Loaded: 2445

--- Loading Benign: AttackQA ---
  Loaded: 25335

  BENIGN TOTALS: WebArena=812, TAU2=0, WebLINX=100, AgentDojo=2445, AttackQA=25335

============================================================
              CIRCUIT BREAKER INGESTION SUMMARY
============================================================
  Total Harmful Pairs: 37763
  Total Benign Pairs:  28692

  âœ… Data is reasonably balanced (ratio: 1.32:1 harmful:benign).
============================================================
ðŸ—‚ï¸   Backed up existing harmful_pairs.jsonl â†’ /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/_backups/harmful_pairs.jsonl.20260107_195334.bak
ðŸ—‚ï¸   Backed up existing benign_pairs.jsonl â†’ /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/_backups/benign_pairs.jsonl.20260107_195334.bak
âœ… Wrote 37763 rows to /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/harmful/harmful_pairs.jsonl
âœ… Wrote 28692 rows to /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/benign/benign_pairs.jsonl

============================================================
  NEXT STEPS:
============================================================
  1. Extract completions (REQUIRED for proper CB training):
     python scripts/format_for_cb/split_out_cb_completions.py --fujitsu-success-only

  2. Create training batches from completions:
     python scripts/format_for_cb/create_cb_batches.py

  Or run the full pipeline:
     python scripts/prepare_cb_training.py
============================================================

=== Split Summary ===
Harmful extracted to completions: 22757
Harmful remaining prompt-only:     15006
Benign extracted to completions:  27769
Benign remaining prompt-only:     923

Wrote:
- /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/harmful/harmful_pairs.prompt_only.jsonl
- /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/harmful/harmful_pairs.completions.jsonl
- /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/harmful/harmful_pairs.rejected.jsonl
- /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/benign/benign_pairs.prompt_only.jsonl
- /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/benign/benign_pairs.completions.jsonl
- /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/benign/benign_pairs.rejected.jsonl

======================================================================
  CIRCUIT BREAKER BATCH CREATION
======================================================================

--- Loading Harmful Data ---
  Source: harmful_pairs.completions.jsonl (22757/22757 with completions)
  Loaded: 22757 samples
  Completion coverage:
    - With 'text' field: 22757
    - With 'harmful_completion': 0
    - Prompt-only: 0

--- Loading Benign Data ---
  Source: benign_pairs.completions.jsonl (27769/27769 with completions)
  Loaded: 27769 samples
  Completion coverage:
    - With 'text' field: 27769
    - With 'benign_completion': 0
    - Prompt-only: 0

--- Creating Balanced Batches ---
  Batch size: 16 (8 harmful + 8 benign)
  Created: 2844 batches (max possible: 2844)
  Total samples used: 45504
  Backed up: cb_training_batches.jsonl -> cb_training_batches.jsonl.20260107_195345.bak

âœ… Wrote 2844 batches to /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/cb_training_batches.jsonl

======================================================================
  SUMMARY
======================================================================
  Harmful samples with completions: 22757/22757 (100.0%)
  Benign samples with completions: 27769/27769 (100.0%)
======================================================================

######################################################################
#                                                                    #
#  CIRCUIT BREAKER TRAINING DATA PREPARATION PIPELINE                #
#                                                                    #
######################################################################

======================================================================
  STEP: Ingest Raw Data
======================================================================
  Command: /project/6105522/memoozd/.venvs/cb_env/bin/python /project/6105522/memoozd/harmful-agents-meta-dataset/scripts/ingest_cb_data.py


âœ… STEP COMPLETE: Ingest Raw Data

======================================================================
  STEP: Extract Completions
======================================================================
  Command: /project/6105522/memoozd/.venvs/cb_env/bin/python /project/6105522/memoozd/harmful-agents-meta-dataset/scripts/format_for_cb/split_out_cb_completions.py --write-rejected --fujitsu-success-only


âœ… STEP COMPLETE: Extract Completions

======================================================================
  STEP: Create Training Batches
======================================================================
  Command: /project/6105522/memoozd/.venvs/cb_env/bin/python /project/6105522/memoozd/harmful-agents-meta-dataset/scripts/format_for_cb/create_cb_batches.py --batch-size 16


âœ… STEP COMPLETE: Create Training Batches

######################################################################
#  PIPELINE COMPLETE                                                 #
######################################################################

  Training batches: /project/6105522/memoozd/harmful-agents-meta-dataset/data/circuit_breakers/cb_training_batches.jsonl
  Total batches: 2844
  Total samples: 45504

  Next: Run training with:
    python scripts/train_circuit_breaker.py --preset llama-3.1-8b-instruct

  Or run diagnostics first:
    python scripts/diagnose_cb_pipeline.py --device cpu

==========================================
Verification
==========================================
Training batches created: 2844
File: data/circuit_breakers/cb_training_batches.jsonl

Checking for harmful completions...
  Harmful samples with completions: 22752/22752 (100.0%)
  OK: Majority have completions

==========================================
Data preparation completed!
Date: Wed Jan  7 02:53:48 PM EST 2026

Next: Run training with:
  sbatch slurm/Killarney/killarney_cb_llama31_8b_4xl40s.sbatch
==========================================
~